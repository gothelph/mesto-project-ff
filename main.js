(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?t(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function r(t,n,r){return(n=function(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}var o={baseUrl:"https://nomoreparties.co/v1/wff-cohort-33",headers:{authorization:"b72732a2-c755-4606-91d6-c4b14824c970"}};function c(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function i(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",u)}function a(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u)}function u(e){"Escape"===e.code&&a(document.querySelector(".popup_is-opened"))}function l(e,t,n){e.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(o.baseUrl,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:o.headers}).then(c).then((function(e){return e.likes}))}(t).then((function(e){n.textContent=e.length})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(o.baseUrl,"/cards/").concat(e,"/likes"),{method:"PUT",headers:o.headers}).then(c).then((function(e){return e.likes}))}(t).then((function(e){n.textContent=e.length})).catch((function(e){return console.log(e)})),e.classList.toggle("card__like-button_is-active")}function s(e,t){var n=document.querySelector(".popup_type_image"),r=n.querySelector(".popup__image");n.querySelector(".popup__caption").textContent=e,r.src=t,r.alt="Фотография места: ".concat(e),i(n)}function d(e){var t;(t=e.getAttribute("data-id"),fetch("".concat(o.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:o.headers}).then(c)).then((function(){return e.remove()})).catch((function(e){return console.log(e)}))}var p,f,m=document.querySelector(".places__list"),v=document.querySelector(".popup_type_edit"),_=document.querySelector(".popup_type_new-card"),y=document.querySelector(".profile__image"),b=document.querySelector(".popup_type_avatar"),h=y.querySelector(".profile__image-avatar"),S=document.querySelector(".profile__edit-button"),g=document.querySelector(".profile__add-button"),E=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),C=document.forms["edit-profile"],L=document.forms["new-place"],k=document.forms["edit-avatar"],O=C.querySelector(".popup__input_type_name"),w=C.querySelector(".popup__input_type_description");function j(e,t){var n=function(e,t){var n=e.name,r=e.link,o=e._id,c=e.likes,i=void 0===c?[]:c,a=e.owner,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=u.onDeleteCard,s=u.onLikeCard,d=u.onOpenPreview,p=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0);p.querySelector(".card__title").textContent=n;var f=p.querySelector(".card__image");f.src=r,f.alt=n;var m=p.querySelector(".card__like-button"),v=p.querySelector(".likes__counter");v.textContent=i.length,i.some((function(e){return e._id===t}))&&m.classList.add("card__like-button_is-active"),m.addEventListener("click",(function(){null==s||s(m,o,v)}));var _=p.querySelector(".card__delete-button");return t===a._id?(p.setAttribute("data-id",o),_.addEventListener("click",(function(){return null==l?void 0:l(p)}))):_.style.display="none",f.addEventListener("click",(function(){return null==d?void 0:d(n,r)})),p}(e,t,{onDeleteCard:d,onLikeCard:l,onOpenPreview:s});m.prepend(n)}document.querySelectorAll(".popup").forEach((function(e){e.classList.add("popup_is-animated"),e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&a(e)})),e.querySelector(".popup__close").addEventListener("click",(function(){a(e)}))})),fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then(c).then((function(e){var t=e.name,n=e.about,r=e.avatar,i=e._id;E.textContent=t,q.textContent=n,h.src=r,fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then(c).then((function(e){return e.toSorted((function(e,t){return new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()})).forEach((function(e){return j(e,i)}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)})),L.addEventListener("submit",(function(e){e.preventDefault();var t,r=L["place-name"].value,i=L.link.value;j({name:r,link:i}),t={name:r,link:i},fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:n(n({},o.headers),{},{"Content-Type":"application/json"}),body:JSON.stringify(t)}).then(c),a(_),L.reset()})),C.addEventListener("submit",(function(e){var t;e.preventDefault(),(t={name:O.value,about:w.value},fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:n(n({},o.headers),{},{"Content-Type":"application/json"}),body:JSON.stringify(t)}).then(c)).then((function(e){var t=e.name,n=e.about;E.textContent=t,q.textContent=n,a(v),C.reset()})).catch((function(e){return console.log(e)}))})),k.addEventListener("submit",(function(e){e.preventDefault();var t,r,i=k.avatar.value;(t=k.querySelector("button")).classList.add("popup__button_disabled"),t.textContent="Сохранение...",(r=i,fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:n(n({},o.headers),{},{"Content-Type":"application/json"}),body:JSON.stringify({avatar:r})}).then(c)).then((function(){h.src=i,k.reset(),a(b)})).catch((function(e){console.log(e)})).finally((function(){!function(e){var t=e.querySelector("button");t.classList.remove("popup__button_disabled"),t.textContent="Сохранить"}(k)}))})),S.addEventListener("click",(function(){O.value=E.textContent,w.value=q.textContent,i(v)})),g.addEventListener("click",(function(){return i(_)})),y.addEventListener("click",(function(){return i(b)})),f=(p={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}).formSelector,Array.from(document.querySelectorAll(f)).forEach((function(e){!function(e,t){var n=t.inputSelector;Array.from(e.querySelectorAll(n)).forEach((function(n){n.addEventListener("input",(function(){!function(e){var t=e.formElement,n=e.inputElement,r=e.validationSettings;if(n.validity.valid)!function(e){var t=e.formElement,n=e.inputElement,r=e.validationSettings,o=r.inputErrorClass,c=r.errorClass,i=r.inactiveButtonClass,a=r.submitButtonSelector,u=t.querySelector(".".concat(n.id,"-error"));t.querySelector(a).classList.remove(i),n.classList.remove(o),u.classList.remove(c),u.textContent=""}({formElement:t,inputElement:n,validationSettings:r});else{var o=n.validationMessage;n.validity.patternMismatch&&(o=n.getAttribute("data-pattern-error-message")),function(e){var t=e.formElement,n=e.inputElement,r=e.errorMessage,o=e.validationSettings,c=o.inputErrorClass,i=o.errorClass,a=o.inactiveButtonClass,u=o.submitButtonSelector,l=t.querySelector(".".concat(n.id,"-error"));t.querySelector(u).classList.add(a),n.classList.add(c),l.classList.add(i),l.textContent=r}({formElement:t,inputElement:n,errorMessage:o,validationSettings:r})}}({formElement:e,inputElement:n,validationSettings:t})}))}))}(e,p)}))})();